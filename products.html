<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Excel Okuma + Filtreleme + SÄ±ralama</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }

    #filters {
      margin-bottom: 20px;
    }

    label {
      margin-right: 10px;
    }

    table.dataTable thead input {
      width: 100%;
    }
  </style>
</head>
<body>

  <h2>Excel Verileri</h2>

  <div id="filters">
    <label>Tarih BaÅŸlangÄ±Ã§: <input type="date" id="startDate"></label>
    <label>Tarih BitiÅŸ: <input type="date" id="endDate"></label>
  </div>

  <div id="output"></div>

  <script>
    async function okuExcel() {
      const response = await fetch('ButkonNameExercise.xlsx');
      const arrayBuffer = await response.arrayBuffer();
      const data = new Uint8Array(arrayBuffer);
      const workbook = XLSX.read(data, { type: 'array' });

      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

      // Tablo oluÅŸtur
      let html = "<table id='excelTable' class='display'><thead><tr>";
      jsonData[0].forEach(cell => {
        html += `<th>${cell}</th>`;
      });
      html += "</tr></thead><tbody>";

      for (let i = 1; i < jsonData.length; i++) {
        html += "<tr>";
        jsonData[i].forEach(cell => {
          html += `<td>${cell}</td>`;
        });
        html += "</tr>";
      }

      html += "</tbody></table>";
      document.getElementById('output').innerHTML = html;

      // DataTable baÅŸlat
      const table = $('#excelTable').DataTable({
        pageLength: 10,
        language: {
          search: "Arama:",
          lengthMenu: "_MENU_ kayÄ±t gÃ¶ster",
          zeroRecords: "EÅŸleÅŸen kayÄ±t bulunamadÄ±",
          info: "_TOTAL_ kayÄ±ttan _START_ - _END_ arasÄ± gÃ¶steriliyor",
          infoEmpty: "KayÄ±t yok",
          paginate: {
            next: "Sonraki",
            previous: "Ã–nceki"
          }
        },
        initComplete: function () {
          // SÃ¼tunlara gÃ¶re filtreleme (ilk 3 sÃ¼tun iÃ§in Ã¶rnek)
          this.api().columns([0, 1, 2]).every(function () {
            const column = this;
            const input = $('<input type="text" placeholder="Filtrele">')
              .appendTo($(column.header()).empty())
              .on('keyup change', function () {
                column.search($(this).val()).draw();
              });
          });
        }
      });

      // ðŸ“… Tarih filtreleme (Ã¶rnek: 3. sÃ¼tun tarih olsun)
      $.fn.dataTable.ext.search.push(
        function (settings, data, dataIndex) {
          const start = $('#startDate').val();
          const end = $('#endDate').val();
          const dateStr = data[2]; // 3. sÃ¼tun (0-index)

          if (!dateStr) return true;

          const cellDate = new Date(dateStr);
          if (isNaN(cellDate)) return true;

          if (
            (!start || new Date(start) <= cellDate) &&
            (!end || cellDate <= new Date(end))
          ) {
            return true;
          }

          return false;
        }
      );

      $('#startDate, #endDate').on('change', function () {
        table.draw();
      });
    }

    window.onload = okuExcel;
  </script>

</body>
</html>
